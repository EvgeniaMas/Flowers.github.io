function WICard(obj,plugins){this.widjetX=0,this.widjetY=0,this.widjetObj,this.widjetPos,this.cardID="",this.DATA={},this.IDS=[],this.objNAME=obj,this.CONFIG={},this.IMG="iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABpFBMVEUAAABEREBEREBEREBEREASEhEJCQgGBgYBAQEAAAAGBgUHBwYAAAAAAAADAwNEREBEREAJCQkICAcGBgYFBQUJCQgnJyVEREAICAgBAQEAAAAICAcAAAAAAAAAAAAJCQgAAAAGBgYBAQEQEA8NDQwHBwcBAQEMDAsSEhEJCQkBAQEBAQEBAQFAQDxEREBEREADAwIAAAABAQESEhEkJCIAAAAICAgAAAAQEA9EREAAAAATExIAAAAKCgkNDQwAAAAAAAABAQETExIHBwcDAwMDAwMTExIAAAAAAAABAQEAAAAAAAAAAAAAAAAAAAAAAAADAwIAAAAGBgUBAQEWFhUAAAAAAAAHBwYBAQEVFRMDAwMHBwcUFBMWFhUBAQETExIAAAAAAAADAwMMDAsAAAAAAAASEhEAAAAUFBMAAAAJCQkrKygDAwMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAwMAAAAJCQgAAAAiIiABAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQFEREAFBQUBAQEAAAAGBgYICAgHBwcBAQEJW8x2AAAAhXRSTlMAAQcIAjJ0kZqZnp+LaygNDxKw/v6wIwPY1A+upf4nenGWvXCg/Pubc8eSmLkcHxpW+vlhBr6hl3EDUl9pop5Q+fhe+1FPXVT8mlxfXWD9+1dbnPRRRved9ldI+Fhd+mBaVlSYWJN1V2dqwwVTA8ORvJXAknRzKii2rCjc3BUTqagrepgUbRZwswAAAAlwSFlzAAAASAAAAEgARslrPgAAAb1JREFUOMuNk2dTwkAQhpdiCZagotiwd5RYQeyKJdii2FDsvffeG0TJnza3lzg4kBnv0zt5NpvdZ3IA/zs6vUGv00wAxrj4hESGnERTkomk5JRU1swaFZ6WnhEMieSEgl9qsmRmWVWe/R2W8KkUjkw5uUr/vNhcEvPpLHEZGly0FYA8pb4wqMFFscioBzAU06lKSsvKKa+orKqmqYY1yB3smGvrHFx9A0mNTQ6uuQU7Oc1yB50Lc6uDc0ObXNHYTlIHfqmTJaZcmLvkpwDdPb19hAODkzjRlAuzpx93GhhEPsTjpF6gBTg1PyxnN4d8hHKJoQUhuhU/qvKxcWVTWmAPKlsLE5RP8qoJLND5vhQ/U9PIYWZWNcWgyTnFpH+ecoCFgNKTQZM+atK/qHI3txSg73gjTC6vIF9dw0nXhSiTG8g3eaEeJ92KMrlN+I4gSp5dkvaiTO4fAKwJ6PQQ4Og4wuQJ3fp070zZXzhJOafpAgsuQ2Gtf+4KC64tWtx2gybZW61/8g7QpPn+ITZ/fAI0yVqfX2wx+r8+gxVNkl3f3j+cnU4v3j4vSa73NwDrJ5qkt+f3Jv5N6u3Vvt0/UGcpYbC85ecAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTMtMDUtMThUMDY6MDM6MzEtMDU6MDALk1CfAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDEzLTA1LTE4VDA2OjAzOjMxLTA1OjAwes7oIwAAAABJRU5ErkJggg==",this.init=function(a,b){this.CONFIG=b||{};try{this.DATA=JSON.parse(localStorage.getItem(a)),$.isEmptyObject(this.DATA)&&(this.DATA={})}catch(a){this.DATA={}}try{this.IDS=JSON.parse(localStorage.getItem(a+"_ids")),$.isEmptyObject(this.IDS)&&(this.IDS=[])}catch(a){this.IDS=[]}this.cardID=a,this.widjetObj=$("#"+a),$.isEmptyObject(this.DATA)?this.widjetObj.html(local.basket_is_empty):(this.reCalc(),this.renderBasketTable())},this.addToCart=function(a,b,c){var d=1;$("input").is("#"+wiNumInputPrefID+b)&&(d=parseInt($("#"+wiNumInputPrefID+b).val())),b=$.isNumeric(b)?"ID"+b.toString():b;var e=$.isEmptyObject(c.subid)?b:b+"_"+c.subid,f={id:e,name:c.name,price:c.price,num:d,url:document.location.href,photo:""};if($.isEmptyObject(this.DATA))this.DATA[e]=f,this.IDS.push(e);else for(var g in this.DATA)$.inArray(e,this.IDS)===-1?(this.DATA[e]=f,this.IDS.push(e)):g==e&&(this.DATA[g].num+=d);localStorage.setItem(this.cardID,JSON.stringify(this.DATA)),localStorage.setItem(this.cardID+"_ids",JSON.stringify(this.IDS)),this.reCalc(),this.renderBasketTable(),this.CONFIG.showAfterAdd&&cart.showWinow("bcontainer",1)},this.reCalc=function(){var a=0,b=0;for(var c in this.DATA)a+=parseInt(this.DATA[c].num),b+=parseFloat(parseInt(this.DATA[c].num)*parseFloat(this.DATA[c].price));"function"==typeof WICartConvert&&(b=WICartConvert(b)),this.widjetObj.html(local.goods+" "+a+" "+local.amount+" "+b+" Руб."),localStorage.setItem(this.cardID,JSON.stringify(this.DATA))},this.clearBasket=function(){this.DATA={},this.IDS=[],this.widjetObj.html(local.basket_is_empty),localStorage.setItem(this.cardID,"{}"),localStorage.setItem(this.cardID+"_ids","[]"),$("#btable").html(""),$("#bcontainer").remove(),$("#blindLayer").remove()},this.renderBasketTable=function(){0==$("#bcontainer").length?$("body").append(" \t\t\t\t<div id='blindLayer' class='blindLayer'></div> \t\t\t\t<div id='bcontainer' class='bcontainer'> \t\t\t\t<div id='bsubject'>"+local.basket+"<a id='bclose' href='#' onclick='"+this.objNAME+".closeWindow(\"bcontainer\", 1);'><img src='data:image/jpeg;base64,"+this.IMG+"' /></a></div> \t\t\t\t<table id='bcaption'><tr><td>ID</td><td>"+local.name+"</td><td>"+local.price+"</td><td>"+local.num+"</td><td>"+local.all+"</td><td></td></tr></table> \t\t\t\t<div id='overflw'><table class='btable' id='btable'></table></div> \t\t\t\t<div id='bfooter'> <button class='bbutton' onclick=\"cart.showWinow('order', 1)\">"+local.order+"</button><span id='bsum'>...</span></div> \t\t\t\t</div> \t\t\t"):$("#btable").html(""),this.center($("#bcontainer"));for(var idkey in this.DATA){with(this.DATA[idkey])var productLine='<tr class="bitem" id="wigoodline-'+id+'"> \t\t\t\t\t\t\t\t\t\t\t\t\t<td>'+id+'</td> \t\t\t\t\t\t\t\t\t\t\t\t\t<td><a href="'+url+'">'+photo+name+'</a></td> \t\t\t\t\t\t\t\t\t\t\t\t\t<td id="lineprice_'+id+'"class="wigoodprice">'+price+' руб.</td> \t\t\t\t\t\t\t\t\t\t\t\t\t<td> \t\t\t\t\t\t\t\t\t\t\t\t\t<div class="basket_num_buttons" id="minus_'+id+'">-</div> \t\t\t\t\t\t\t\t\t\t\t\t\t<span class="basket_num" id="basket_num_'+id+'">'+num+'</span> \t\t\t\t\t\t\t\t\t\t\t\t\t<div class="basket_num_buttons" id="plus_'+id+'">+</div></td> \t\t\t\t\t\t\t\t\t\t\t\t\t<td id="linesum_'+id+'">'+parseFloat(price*num)+' руб.</td> \t\t\t\t\t\t\t\t\t\t\t\t\t<td><a href="#" onclick="'+this.objNAME+".delItem('"+id+'\')"><img src="data:image/jpeg;base64,'+this.IMG+'" /></a></td> \t\t\t\t\t\t\t\t\t\t\t\t\t</tr>';$("#btable").append(productLine),$(".basket_num_buttons").data("min-value")}var self=this;for(var ids in this.IDS)$("#minus_"+this.IDS[ids]).bind("click",function(){var a=$(this).attr("id").substr(6),b=parseInt($("#basket_num_"+a).text()),b=b>1?b-1:1;self.DATA[a].num=b,$("#basket_num_"+a).html(b);var c=parseFloat($("#lineprice_"+a).html());$("#linesum_"+a).html(parseFloat(c*b)+" руб."),self.sumAll(),self.reCalc()}),$("#plus_"+this.IDS[ids]).bind("click",function(){var a=$(this).attr("id").substr(5),b=parseInt($("#basket_num_"+a).text()),b=b<1e6?b+1:1e6;self.DATA[a].num=b,$("#basket_num_"+a).html(b);var c=parseFloat($("#lineprice_"+a).html());$("#linesum_"+a).html(parseFloat(c*b)+" руб."),self.sumAll(),self.reCalc()});this.sumAll()},this.sumAll=function(){var a=0;for(var b in this.DATA)a+=parseFloat(this.DATA[b].price*this.DATA[b].num);$("#bsum").html(a+" руб.")},this.center=function(a){return a.css({top:"200px"}),a.css({left:Math.max(0,($(window).width()-$(a).outerWidth())/2+$(window).scrollLeft())+"px"}),a},this.showWinow=function(a,b){$("#"+a).show(),b&&$("#blindLayer").show()},this.closeWindow=function(a,b){$("#"+a).hide(),b&&$("#blindLayer").hide()},this.delItem=function(a){confirm("Удалить #"+a+"?")&&($("#btable").html(""),delete this.DATA[a],this.IDS.splice($.inArray(a,this.IDS),1),this.reCalc(),this.renderBasketTable(),localStorage.setItem(this.cardID,JSON.stringify(this.DATA)),localStorage.setItem(this.cardID+"_ids",JSON.stringify(this.IDS)),0==this.IDS.length&&this.widjetObj.html(local.basket_is_empty))},this.sendOrder=function(a){for(var b="",c=a.split(","),d=0;d<c.length;d++)b+=this.getForm(c[d])+"<br><br>";$(".basket_num_buttons").remove(),$.post("sendmail.php?subj=Order WICart",{order:b}).done(function(a){cart.closeWindow("bcontainer",1),cart.closeWindow("order",0),cart.CONFIG.clearAfterSend&&cart.clearBasket(),alert(local.send)})},this.getForm=function(a){var b=document.getElementById(a),c=b.cloneNode(!0);return INPUTS=[].slice.call(c.querySelectorAll("input,textarea")),INPUTS.forEach(function(a){if("INPUT"!=a.tagName||"text"!=a.type&&"hidden"!=a.type){if("TEXTAREA"==a.tagName){var b=document.createElement("b");b.innerHTML=a.placeholder,a.parentNode.insertBefore(b,a);var c=document.createElement("div");c.innerHTML=$("#"+a.id).val(),a.parentNode.replaceChild(c,a)}}else{var b=document.createElement("b");b.innerHTML=a.placeholder,a.parentNode.insertBefore(b,a);var c=document.createElement("div");c.innerHTML=a.value,a.parentNode.replaceChild(c,a)}}),c.innerHTML}}var local={basket_is_empty:"Корзина пуста",name:"Название",price:"Цена",all:"Всего",order:"Оформить заказ",basket:"Ваша корзина",num:"кол-во",send:"Спасибо за покупку!\nМы свяжемся с Вами в ближайшее время",goods:"Оформите заказ:",amount:"на"};